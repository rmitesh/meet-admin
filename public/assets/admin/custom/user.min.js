"use strict";

$(document).ready(function() {
	let $users_table = document.getElementById('users-table');
	if ( $users_table ) {
		let $users_datatable = $($users_table).DataTable({
			aaSorting: [],
		    processing: true,
		    serverSide: true,
			ajax: USER_URL,
			columns: [
			    { data: 'DT_RowIndex', name: 'DT_RowIndex', width: "5%", orderable: false, searchable: false },
			    { data: 'name', name: 'name' },
			    { data: 'email', name: 'email' },
			    { data: 'created_at', name: 'created_at', width: "15%" },
			    { data: 'action', name: 'action', orderable: false, searchable: false, width: "15%" },
			],
    	});

		/* Delete User */
		$(document).on('click', '.delete-user', function(event) {
			event.preventDefault();
			let id = $(this).attr('data-xid');
			if (id) {
				let __callback = () => {
					$.ajax({
						url: `${USER_URL}/delete/${id}`,
						type: 'DELETE',
						dataType: 'json',
						beforeSend: () => {
							// loader
						},
						complete: response => {
							let resp = response.responseJSON;
							if ( resp ) {
								if (resp.status) {
									toast_success(resp.message);
									$users_datatable.ajax.reload();
								} else {
									toast_error(resp.message);
								}
							}
						},
					});
				};

				swal_confirmation(__callback);
			}
		});
	}
});
