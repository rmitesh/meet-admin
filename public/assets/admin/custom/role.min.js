"use strict";

$(document).ready(function() {
	let $roles_table = document.getElementById('roles-table');
	if ( $roles_table ) {
		let $roles_datatable = $($roles_table).DataTable({
			aaSorting: [],
		    processing: true,
		    serverSide: true,
			ajax: ROLE_URL,
			columns: [
			    { data: 'DT_RowIndex', name: 'DT_RowIndex', width: "5%", orderable: false, searchable: false },
			    { data: 'name', name: 'name' },
			    { data: 'created_at', name: 'created_at', width: "15%" },
			    { data: 'action', name: 'action', orderable: false, searchable: false, width: "15%" },
			],
    	});

		/* Delete Role */
		$(document).on('click', '.delete-role', function(event) {
			event.preventDefault();
			let id = $(this).attr('data-xid');
			if (id) {
				let __callback = () => {
					$.ajax({
						url: `${ROLE_URL}/delete/${id}`,
						type: 'DELETE',
						dataType: 'json',
						beforeSend: () => {
							// loader
						},
						complete: response => {
							let resp = response.responseJSON;
							if ( resp ) {
								if (resp.status) {
									toast_success(resp.message);
									$roles_datatable.ajax.reload();
								} else {
									toast_error(resp.message);
								}
							}
						},
					});
				};

				swal_confirmation(__callback);
			}
		});
	}
});

$(document).on('change', '#permission-all', function(event) {
	event.preventDefault();
	$('.permissions').prop('checked', $(this).prop('checked'));
});

$(document).on('change', '.permissions', function(event) {
	event.preventDefault();
	if ($('.permissions').length === $('.permissions:checked').length) {
		$('#permission-all').prop('checked', true);
	} else {
		$('#permission-all').prop('checked', false);
	}
});
